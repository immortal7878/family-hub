<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Family Hub">
<meta name="theme-color" content="#E07A5F">
<meta name="description" content="Family Hub Command Center">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Family Hub</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #FFF8F0;
  --bg2: #F5F0E8;
  --card: #FFFBF5;
  --border: #F0EDE8;
  --border2: #E0DBD4;
  --text: #2D3436;
  --muted: #636E72;
  --faint: #B2BEC3;
  --serge: #E07A5F;
  --yulya: #81B29A;
  --alice: #F2CC8F;
  --matthew: #3D405B;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; overflow: hidden; }

body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  color: var(--text);
  background: linear-gradient(160deg, var(--bg) 0%, var(--bg2) 40%, #EDE8DF 100%);
  overscroll-behavior: none;
}

.app {
  display: flex; flex-direction: column;
  height: 100vh; height: 100dvh;
  max-width: 600px; margin: 0 auto;
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
}

/* â”€â”€â”€ Header â”€â”€â”€ */
.header {
  padding: 20px 20px 0; flex-shrink: 0;
  animation: fadeUp 0.5s ease;
}
.header-row { display: flex; justify-content: space-between; align-items: flex-start; }
.header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 28px; font-weight: 800; letter-spacing: -0.5px;
}
.header .subtitle { color: var(--muted); font-size: 13px; margin-top: 4px; }
.avatars { display: flex; }
.avatar {
  width: 34px; height: 34px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px; border: 3px solid var(--card);
  position: relative;
}
.avatar + .avatar { margin-left: -8px; }

/* â”€â”€â”€ Quick Stats â”€â”€â”€ */
.stats {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
  margin: 16px 0; padding: 0 20px;
  animation: fadeUp 0.6s ease;
}
.stat-card {
  background: var(--card); border-radius: 14px; padding: 12px 14px;
  border: 1px solid var(--border);
  box-shadow: 0 2px 8px rgba(0,0,0,0.03);
}
.stat-icon { font-size: 18px; }
.stat-value {
  font-size: 24px; font-weight: 800;
  font-family: 'Playfair Display', serif;
}
.stat-label {
  font-size: 10px; color: var(--faint);
  font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
}

/* â”€â”€â”€ Tabs â”€â”€â”€ */
.tabs {
  display: flex; gap: 3px; padding: 0 20px;
  margin-bottom: 12px; flex-shrink: 0;
}
.tab-bar {
  display: flex; gap: 3px; background: var(--border);
  border-radius: 13px; padding: 3px; width: 100%;
}
.tab {
  flex: 1; padding: 9px 0; border-radius: 10px; border: none;
  background: transparent; color: var(--faint);
  font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 700;
  cursor: pointer; transition: all 0.25s;
  text-align: center;
}
.tab.active {
  background: var(--card); color: var(--text);
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.tab-icon { display: block; font-size: 15px; margin-bottom: 1px; }

/* â”€â”€â”€ Content â”€â”€â”€ */
.content {
  flex: 1; overflow-y: auto; padding: 0 20px 20px;
  -webkit-overflow-scrolling: touch;
}
.content-card {
  background: var(--card); border-radius: 18px;
  padding: 20px; border: 1px solid var(--border);
  box-shadow: 0 4px 20px rgba(0,0,0,0.04);
  animation: fadeUp 0.35s ease;
}

/* â”€â”€â”€ Calendar â”€â”€â”€ */
.cal-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
.cal-title {
  font-family: 'Playfair Display', serif;
  font-size: 17px; font-weight: 700; min-width: 150px; text-align: center;
}
.nav-btn {
  width: 32px; height: 32px; border-radius: 50%;
  border: 1px solid var(--border2); background: var(--card);
  cursor: pointer; font-size: 18px; color: var(--muted);
  display: flex; align-items: center; justify-content: center;
}
.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 6px; }
.cal-day-label {
  text-align: center; font-size: 10px; font-weight: 700;
  color: var(--faint); padding: 3px 0; text-transform: uppercase; letter-spacing: 0.8px;
}
.cal-cell {
  min-height: 44px; border-radius: 8px; padding: 2px;
  border: 1px solid var(--border); position: relative;
}
.cal-cell.empty { border: none; }
.cal-cell.today { border: 2px solid var(--serge); background: rgba(224,122,95,0.06); }
.cal-num {
  font-size: 11px; font-weight: 500; color: var(--muted);
  text-align: right; padding: 1px 5px 0 0;
}
.cal-cell.today .cal-num { color: var(--serge); font-weight: 800; }
.cal-dots { display: flex; gap: 2px; padding: 1px 3px; flex-wrap: wrap; }
.cal-dot {
  font-size: 8px; border-radius: 3px; padding: 0 3px;
  font-weight: 600; overflow: hidden; text-overflow: ellipsis;
  white-space: nowrap; max-width: 100%;
}
.upcoming-label {
  font-size: 11px; font-weight: 700; color: var(--faint);
  text-transform: uppercase; letter-spacing: 1px; margin: 10px 0 6px;
}
.event-row {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px; background: #fff; border-radius: 10px;
  margin-bottom: 3px; border: 1px solid var(--border);
}
.event-bar { width: 4px; height: 26px; border-radius: 2px; flex-shrink: 0; }
.event-info { flex: 1; }
.event-title { font-size: 13px; font-weight: 600; }
.event-meta { font-size: 11px; color: var(--faint); }

/* â”€â”€â”€ Chores â”€â”€â”€ */
.chore-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.progress-bar { width: 110px; height: 6px; background: var(--border); border-radius: 3px; margin-top: 4px; }
.progress-fill { height: 6px; background: var(--yulya); border-radius: 3px; transition: width 0.4s ease; }
.chore-row {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px; background: #fff; border-radius: 11px;
  border: 1px solid var(--border); margin-bottom: 3px;
  transition: all 0.2s;
}
.chore-row.done { opacity: 0.5; background: #F8F7F4; }
.chore-check {
  width: 22px; height: 22px; border-radius: 6px; border-width: 2px; border-style: solid;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 13px; font-weight: 700; color: #fff;
  transition: all 0.2s; flex-shrink: 0; background: transparent;
}
.chore-check.checked { color: #fff; }
.chore-task { font-size: 14px; font-weight: 500; }
.chore-row.done .chore-task { text-decoration: line-through; }
.chore-sub { font-size: 11px; color: var(--faint); }

/* â”€â”€â”€ Groceries â”€â”€â”€ */
.grocery-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.cat-label { font-size: 11px; font-weight: 700; color: var(--faint); text-transform: uppercase; letter-spacing: 1px; margin: 8px 0 4px; }
.grocery-row {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px; background: #fff; border-radius: 10px;
  border: 1px solid var(--border); margin-bottom: 3px;
  transition: all 0.2s;
}
.grocery-row.checked { opacity: 0.45; background: #F8F7F4; }
.grocery-circle {
  width: 20px; height: 20px; border-radius: 50%;
  border: 2px solid var(--yulya); display: flex; align-items: center;
  justify-content: center; cursor: pointer; font-size: 12px;
  color: #fff; flex-shrink: 0; background: transparent;
}
.grocery-circle.checked { background: var(--yulya); }
.grocery-name { flex: 1; font-size: 14px; }
.grocery-row.checked .grocery-name { text-decoration: line-through; }
.grocery-qty { font-size: 12px; color: var(--faint); }

/* â”€â”€â”€ Bulletin â”€â”€â”€ */
.notes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.note-card {
  border-radius: 14px; padding: 14px 16px; min-height: 75px;
  position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.note-pin { position: absolute; top: 5px; right: 9px; font-size: 13px; }
.note-text { font-size: 13px; line-height: 1.5; font-weight: 500; margin-bottom: 8px; color: var(--text); }
.note-footer { display: flex; justify-content: space-between; align-items: center; }
.note-author { font-size: 11px; color: var(--muted); }
.note-actions { display: flex; gap: 6px; }
.note-actions button {
  background: none; border: none; cursor: pointer;
  font-size: 11px; opacity: 0.5; color: var(--text);
}

/* â”€â”€â”€ Buttons â”€â”€â”€ */
.add-btn {
  padding: 7px 16px; border-radius: 10px; border: none;
  background: var(--serge); color: #fff; font-size: 12px;
  font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif;
}
.del-btn {
  background: none; border: none; cursor: pointer;
  color: var(--border2); font-size: 15px;
}
.pill {
  padding: 5px 14px; border-radius: 18px; border-width: 2px; border-style: solid;
  font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 600;
  cursor: pointer; background: transparent; transition: all 0.2s;
}
.pill.active { color: #fff !important; }

/* â”€â”€â”€ Modal â”€â”€â”€ */
.modal-overlay {
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: flex-end; justify-content: center;
  background: rgba(30,30,30,0.4); backdrop-filter: blur(6px);
}
.modal-sheet {
  background: var(--card); border-radius: 22px 22px 0 0;
  padding: 24px 24px calc(24px + var(--safe-bottom));
  width: 100%; max-width: 600px;
  box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
  animation: slideUp 0.3s ease;
  max-height: 80vh; overflow-y: auto;
}
.modal-handle {
  width: 40px; height: 4px; background: var(--border2);
  border-radius: 2px; margin: 0 auto 16px;
}
.modal-title {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700; margin-bottom: 16px;
}
.modal-input {
  width: 100%; padding: 10px 14px; border-radius: 10px;
  border: 1.5px solid var(--border2); font-size: 14px;
  font-family: 'DM Sans', sans-serif; outline: none;
  background: var(--card); margin-bottom: 8px; color: var(--text);
}
.modal-textarea { resize: vertical; min-height: 70px; }
.modal-pills { display: flex; gap: 6px; flex-wrap: wrap; margin: 6px 0; }
.modal-submit {
  width: 100%; padding: 12px 0; border-radius: 12px; border: none;
  background: var(--serge); color: #fff; font-size: 15px; font-weight: 700;
  cursor: pointer; font-family: 'DM Sans', sans-serif; margin-top: 8px;
}
.color-dot {
  width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
  border: 2px solid transparent; transition: border 0.15s;
}
.color-dot.active { border: 3px solid var(--text); }

@keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

@media (min-width: 601px) {
  .modal-sheet { border-radius: 22px; margin-bottom: 20px; }
  .modal-overlay { align-items: center; }
}
</style>
</head>
<body>
<div id="app" class="app"></div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€
const STORAGE_KEY = "family_hub_data";
const FAMILY = [
  { name: "Serge", color: "#E07A5F", emoji: "ðŸ‘¨" },
  { name: "Yulya", color: "#81B29A", emoji: "ðŸ‘©" },
  { name: "Alice", color: "#F2CC8F", emoji: "ðŸ‘§" },
  { name: "Matthew", color: "#3D405B", emoji: "ðŸ‘¦" },
];
const DAYS = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const NOTE_COLORS = ["#FFEAA7","#FAD9D5","#DFE6E9","#C8E6C9","#D1C4E9","#FFE0B2"];
const CATEGORIES = ["produce","dairy","meat","pantry","bakery","frozen","snacks","drinks"];

function defaultData() {
  const today = new Date();
  const d = (offset) => {
    const dt = new Date(today); dt.setDate(dt.getDate() + offset);
    return dt.toISOString().split("T")[0];
  };
  return {
    events: [
      { id: 1, title: "Tax Filing Deadline", date: d(4), member: "Serge", type: "work" },
      { id: 2, title: "School Play", date: d(2), member: "Alice", type: "school" },
      { id: 3, title: "Dentist Appointment", date: d(7), member: "Yulya", type: "health" },
      { id: 4, title: "Soccer Practice", date: d(0), member: "Alice", type: "activity" },
      { id: 5, title: "Grocery Run", date: d(1), member: "Yulya", type: "errand" },
      { id: 6, title: "Piano Lesson", date: d(3), member: "Matthew", type: "activity" },
    ],
    chores: [
      { id: 1, task: "Take out trash", assignee: "Serge", done: false, recurring: "weekly" },
      { id: 2, task: "Load dishwasher", assignee: "Alice", done: true, recurring: "daily" },
      { id: 3, task: "Vacuum living room", assignee: "Yulya", done: false, recurring: "weekly" },
      { id: 4, task: "Make bed", assignee: "Matthew", done: true, recurring: "daily" },
      { id: 5, task: "Wipe kitchen counters", assignee: "Alice", done: false, recurring: "daily" },
      { id: 6, task: "Sort recycling", assignee: "Serge", done: false, recurring: "weekly" },
    ],
    groceries: [
      { id: 1, item: "Whole milk", qty: "1 gallon", checked: false, category: "dairy" },
      { id: 2, item: "Chicken breast", qty: "2 lbs", checked: false, category: "meat" },
      { id: 3, item: "Bananas", qty: "1 bunch", checked: true, category: "produce" },
      { id: 4, item: "Pasta", qty: "2 boxes", checked: false, category: "pantry" },
      { id: 5, item: "Cheddar cheese", qty: "1 block", checked: false, category: "dairy" },
      { id: 6, item: "Bread", qty: "1 loaf", checked: true, category: "bakery" },
      { id: 7, item: "Eggs", qty: "1 dozen", checked: false, category: "dairy" },
      { id: 8, item: "Broccoli", qty: "2 heads", checked: false, category: "produce" },
    ],
    notes: [
      { id: 1, text: "Don't forget to RSVP for Jake's birthday party by Friday!", author: "Yulya", pinned: true, color: "#FFEAA7", ts: Date.now() - 86400000 },
      { id: 2, text: "Plumber coming Thursday between 2-4pm", author: "Serge", pinned: true, color: "#DFE6E9", ts: Date.now() - 43200000 },
      { id: 3, text: "New WiFi password: SunnyDays2026!", author: "Serge", pinned: false, color: "#FAD9D5", ts: Date.now() - 172800000 },
    ],
  };
}

// â”€â”€â”€ STATE â”€â”€â”€
let state = { tab: "calendar", modal: null, modalData: {}, calMonth: new Date().getMonth(), calYear: new Date().getFullYear() };
let data;

function loadData() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    data = saved ? JSON.parse(saved) : defaultData();
  } catch { data = defaultData(); }
}
function saveData() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch {}
}

function getMember(name) { return FAMILY.find(m => m.name === name) || FAMILY[0]; }
function todayKey() { const t = new Date(); return `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`; }
function dateKey(y, m, d) { return `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`; }
function uid() { return Date.now() + Math.random(); }

// â”€â”€â”€ RENDER â”€â”€â”€
function h(tag, attrs, ...children) {
  const el = document.createElement(tag);
  if (attrs) Object.entries(attrs).forEach(([k, v]) => {
    if (k === "style" && typeof v === "object") Object.assign(el.style, v);
    else if (k.startsWith("on")) el.addEventListener(k.slice(2).toLowerCase(), v);
    else if (k === "className") el.className = v;
    else if (k === "innerHTML") el.innerHTML = v;
    else el.setAttribute(k, v);
  });
  children.flat(Infinity).forEach(c => {
    if (c == null || c === false) return;
    el.appendChild(typeof c === "string" || typeof c === "number" ? document.createTextNode(c) : c);
  });
  return el;
}

function render() {
  const app = document.getElementById("app");
  app.innerHTML = "";
  app.appendChild(renderHeader());
  app.appendChild(renderStats());
  app.appendChild(renderTabs());
  app.appendChild(renderContent());
  if (state.modal) app.appendChild(renderModal());
}

function renderHeader() {
  const today = new Date();
  const hr = today.getHours();
  const greeting = hr < 12 ? "Good morning" : hr < 18 ? "Good afternoon" : "Good evening";
  const avatars = h("div", { className: "avatars" },
    ...FAMILY.map((m, i) => h("div", {
      className: "avatar",
      style: { background: m.color, zIndex: 4 - i }
    }, m.emoji))
  );
  return h("div", { className: "header" },
    h("div", { className: "header-row" },
      h("div", null,
        h("h1", null, "Family Hub"),
        h("p", { className: "subtitle" }, `${greeting}, Serge Â· ${MONTHS[today.getMonth()]} ${today.getDate()}, ${today.getFullYear()}`)
      ),
      avatars
    )
  );
}

function renderStats() {
  const tk = todayKey();
  const todayEvts = data.events.filter(e => e.date === tk).length;
  const pending = data.chores.filter(c => !c.done).length;
  const grocLeft = data.groceries.filter(g => !g.checked).length;
  const stats = [
    { label: "Today's Events", value: todayEvts, color: "var(--serge)", icon: "ðŸ“…" },
    { label: "Pending Chores", value: pending, color: "var(--yulya)", icon: "âœ…" },
    { label: "Grocery Items", value: grocLeft, color: "var(--alice)", icon: "ðŸ›’" },
  ];
  return h("div", { className: "stats" },
    ...stats.map(s => h("div", { className: "stat-card" },
      h("div", { className: "stat-icon" }, s.icon),
      h("div", { className: "stat-value", style: { color: s.color } }, String(s.value)),
      h("div", { className: "stat-label" }, s.label)
    ))
  );
}

function renderTabs() {
  const tabs = [
    { key: "calendar", label: "Calendar", icon: "ðŸ“…" },
    { key: "chores", label: "Chores", icon: "âœ…" },
    { key: "groceries", label: "Groceries", icon: "ðŸ›’" },
    { key: "bulletin", label: "Board", icon: "ðŸ“Œ" },
  ];
  return h("div", { className: "tabs" },
    h("div", { className: "tab-bar" },
      ...tabs.map(t => h("button", {
        className: "tab" + (state.tab === t.key ? " active" : ""),
        onClick: () => { state.tab = t.key; render(); }
      },
        h("span", { className: "tab-icon" }, t.icon), t.label
      ))
    )
  );
}

function renderContent() {
  const wrap = h("div", { className: "content" });
  const card = h("div", { className: "content-card" });
  if (state.tab === "calendar") card.appendChild(renderCalendar());
  else if (state.tab === "chores") card.appendChild(renderChores());
  else if (state.tab === "groceries") card.appendChild(renderGroceries());
  else card.appendChild(renderBulletin());
  wrap.appendChild(card);
  return wrap;
}

// â”€â”€â”€ CALENDAR â”€â”€â”€
function renderCalendar() {
  const { calMonth: month, calYear: year } = state;
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const tk = todayKey();
  const evMap = {};
  data.events.forEach(e => { (evMap[e.date] = evMap[e.date] || []).push(e); });

  const prevM = () => { if (month === 0) { state.calMonth = 11; state.calYear--; } else state.calMonth--; render(); };
  const nextM = () => { if (month === 11) { state.calMonth = 0; state.calYear++; } else state.calMonth++; render(); };

  const frag = h("div");
  // Nav
  frag.appendChild(h("div", { className: "cal-nav" },
    h("div", { style: { display: "flex", alignItems: "center", gap: "10px" } },
      h("button", { className: "nav-btn", onClick: prevM }, "â€¹"),
      h("span", { className: "cal-title" }, `${MONTHS[month]} ${year}`),
      h("button", { className: "nav-btn", onClick: nextM }, "â€º")
    ),
    h("button", { className: "add-btn", onClick: () => openModal("event") }, "+ Event")
  ));

  // Grid
  const grid = h("div", { className: "cal-grid" });
  DAYS.forEach(d => grid.appendChild(h("div", { className: "cal-day-label" }, d)));
  for (let i = 0; i < firstDay; i++) grid.appendChild(h("div", { className: "cal-cell empty" }));
  for (let day = 1; day <= daysInMonth; day++) {
    const key = dateKey(year, month, day);
    const isToday = key === tk;
    const evts = evMap[key] || [];
    const cell = h("div", { className: "cal-cell" + (isToday ? " today" : "") },
      h("div", { className: "cal-num" }, String(day))
    );
    if (evts.length) {
      const dots = h("div", { className: "cal-dots" });
      evts.slice(0, 2).forEach(ev => {
        const m = getMember(ev.member);
        dots.appendChild(h("div", { className: "cal-dot", style: { background: m.color + "30", color: m.color } }, ev.title));
      });
      if (evts.length > 2) dots.appendChild(h("div", { style: { fontSize: "8px", color: "var(--faint)" } }, `+${evts.length - 2}`));
      cell.appendChild(dots);
    }
    grid.appendChild(cell);
  }
  frag.appendChild(grid);

  // Upcoming
  const upcoming = data.events.filter(e => e.date >= tk).sort((a, b) => a.date.localeCompare(b.date)).slice(0, 5);
  if (upcoming.length) {
    frag.appendChild(h("div", { className: "upcoming-label" }, "Upcoming"));
    upcoming.forEach(ev => {
      const m = getMember(ev.member);
      frag.appendChild(h("div", { className: "event-row" },
        h("div", { className: "event-bar", style: { background: m.color } }),
        h("div", { className: "event-info" },
          h("div", { className: "event-title" }, ev.title),
          h("div", { className: "event-meta" }, `${ev.date} Â· ${ev.member}`)
        ),
        h("button", { className: "del-btn", onClick: () => { data.events = data.events.filter(e => e.id !== ev.id); saveData(); render(); } }, "âœ•")
      ));
    });
  }
  return frag;
}

// â”€â”€â”€ CHORES â”€â”€â”€
function renderChores() {
  const doneCount = data.chores.filter(c => c.done).length;
  const total = data.chores.length;
  const pct = total ? (doneCount / total * 100) : 0;

  const frag = h("div");
  frag.appendChild(h("div", { className: "chore-header" },
    h("div", null,
      h("span", { style: { fontSize: "13px", color: "var(--muted)" } }, `${doneCount}/${total} complete`),
      h("div", { className: "progress-bar" },
        h("div", { className: "progress-fill", style: { width: pct + "%" } })
      )
    ),
    h("button", { className: "add-btn", onClick: () => openModal("chore") }, "+ Chore")
  ));

  data.chores.forEach(c => {
    const m = getMember(c.assignee);
    const toggle = () => { c.done = !c.done; saveData(); render(); };
    const remove = () => { data.chores = data.chores.filter(x => x.id !== c.id); saveData(); render(); };
    frag.appendChild(h("div", { className: "chore-row" + (c.done ? " done" : "") },
      h("div", {
        className: "chore-check" + (c.done ? " checked" : ""),
        style: { borderColor: m.color, background: c.done ? m.color : "transparent" },
        onClick: toggle
      }, c.done ? "âœ“" : ""),
      h("div", { style: { flex: "1" } },
        h("div", { className: "chore-task" }, c.task),
        h("div", { className: "chore-sub" }, `${m.emoji} ${c.assignee} Â· ${c.recurring}`)
      ),
      h("button", { className: "del-btn", onClick: remove }, "âœ•")
    ));
  });
  return frag;
}

// â”€â”€â”€ GROCERIES â”€â”€â”€
function renderGroceries() {
  const remaining = data.groceries.filter(g => !g.checked).length;
  const cats = [...new Set(data.groceries.map(g => g.category))];

  const frag = h("div");
  frag.appendChild(h("div", { className: "grocery-header" },
    h("span", { style: { fontSize: "13px", color: "var(--muted)" } }, `${remaining} items remaining`),
    h("button", { className: "add-btn", onClick: () => openModal("grocery") }, "+ Item")
  ));

  cats.forEach(cat => {
    const items = data.groceries.filter(g => g.category === cat);
    frag.appendChild(h("div", { className: "cat-label" }, cat));
    items.forEach(item => {
      const toggle = () => { item.checked = !item.checked; saveData(); render(); };
      const remove = () => { data.groceries = data.groceries.filter(x => x.id !== item.id); saveData(); render(); };
      frag.appendChild(h("div", { className: "grocery-row" + (item.checked ? " checked" : "") },
        h("div", {
          className: "grocery-circle" + (item.checked ? " checked" : ""),
          onClick: toggle
        }, item.checked ? "âœ“" : ""),
        h("div", { className: "grocery-name" }, item.item),
        h("span", { className: "grocery-qty" }, item.qty),
        h("button", { className: "del-btn", onClick: remove }, "âœ•")
      ));
    });
  });
  return frag;
}

// â”€â”€â”€ BULLETIN â”€â”€â”€
function renderBulletin() {
  const sorted = [...data.notes].sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0) || b.ts - a.ts);
  const frag = h("div");
  frag.appendChild(h("div", { style: { display: "flex", justifyContent: "flex-end", marginBottom: "12px" } },
    h("button", { className: "add-btn", onClick: () => openModal("note") }, "+ Note")
  ));
  const grid = h("div", { className: "notes-grid" });
  sorted.forEach(note => {
    const rot = ((note.id * 7) % 5 - 2) * 0.8;
    const togglePin = () => { note.pinned = !note.pinned; saveData(); render(); };
    const remove = () => { data.notes = data.notes.filter(n => n.id !== note.id); saveData(); render(); };
    grid.appendChild(h("div", { className: "note-card", style: { background: note.color, transform: `rotate(${rot}deg)` } },
      note.pinned ? h("span", { className: "note-pin" }, "ðŸ“Œ") : "",
      h("p", { className: "note-text" }, note.text),
      h("div", { className: "note-footer" },
        h("span", { className: "note-author" }, `â€” ${note.author}`),
        h("div", { className: "note-actions" },
          h("button", { onClick: togglePin }, note.pinned ? "unpin" : "pin"),
          h("button", { onClick: remove }, "âœ•")
        )
      )
    ));
  });
  frag.appendChild(grid);
  return frag;
}

// â”€â”€â”€ MODALS â”€â”€â”€
function openModal(type) {
  state.modal = type;
  if (type === "event") state.modalData = { title: "", date: "", member: "Serge" };
  else if (type === "chore") state.modalData = { task: "", assignee: "Serge", recurring: "daily" };
  else if (type === "grocery") state.modalData = { item: "", qty: "", category: "produce" };
  else if (type === "note") state.modalData = { text: "", author: "Serge", color: "#FFEAA7" };
  render();
}
function closeModal() { state.modal = null; render(); }

function renderModal() {
  const md = state.modalData;
  const overlay = h("div", { className: "modal-overlay", onClick: closeModal });
  const sheet = h("div", { className: "modal-sheet", onClick: e => e.stopPropagation() });
  sheet.appendChild(h("div", { className: "modal-handle" }));

  if (state.modal === "event") {
    sheet.appendChild(h("div", { className: "modal-title" }, "Add Event"));
    sheet.appendChild(makeInput("Event title", md.title, v => md.title = v));
    sheet.appendChild(makeInput("", md.date, v => md.date = v, "date"));
    sheet.appendChild(makeMemberPills(md.member, v => md.member = v));
    sheet.appendChild(h("button", { className: "modal-submit", onClick: () => {
      if (!md.title || !md.date) return;
      data.events.push({ id: uid(), title: md.title, date: md.date, member: md.member, type: "general" });
      saveData(); closeModal();
    }}, "Add Event"));
  } else if (state.modal === "chore") {
    sheet.appendChild(h("div", { className: "modal-title" }, "Add Chore"));
    sheet.appendChild(makeInput("What needs to be done?", md.task, v => md.task = v));
    sheet.appendChild(makeMemberPills(md.assignee, v => md.assignee = v));
    sheet.appendChild(makeOptionPills(["daily","weekly","monthly"], md.recurring, v => md.recurring = v, "var(--matthew)"));
    sheet.appendChild(h("button", { className: "modal-submit", onClick: () => {
      if (!md.task) return;
      data.chores.push({ id: uid(), task: md.task, assignee: md.assignee, done: false, recurring: md.recurring });
      saveData(); closeModal();
    }}, "Add Chore"));
  } else if (state.modal === "grocery") {
    sheet.appendChild(h("div", { className: "modal-title" }, "Add Grocery Item"));
    sheet.appendChild(makeInput("Item name", md.item, v => md.item = v));
    sheet.appendChild(makeInput("Quantity (e.g. 2 lbs)", md.qty, v => md.qty = v));
    sheet.appendChild(makeOptionPills(CATEGORIES, md.category, v => md.category = v, "var(--alice)"));
    sheet.appendChild(h("button", { className: "modal-submit", onClick: () => {
      if (!md.item) return;
      data.groceries.push({ id: uid(), item: md.item, qty: md.qty, checked: false, category: md.category });
      saveData(); closeModal();
    }}, "Add Item"));
  } else if (state.modal === "note") {
    sheet.appendChild(h("div", { className: "modal-title" }, "Post a Note"));
    const ta = h("textarea", {
      className: "modal-input modal-textarea", placeholder: "Write your note...",
      value: md.text,
      onInput: e => md.text = e.target.value
    });
    ta.value = md.text;
    sheet.appendChild(ta);
    sheet.appendChild(makeMemberPills(md.author, v => md.author = v));
    // Color dots
    const colorRow = h("div", { style: { display: "flex", gap: "8px", margin: "8px 0" } });
    NOTE_COLORS.forEach(c => {
      colorRow.appendChild(h("div", {
        className: "color-dot" + (md.color === c ? " active" : ""),
        style: { background: c }, onClick: () => { md.color = c; render(); }
      }));
    });
    sheet.appendChild(colorRow);
    sheet.appendChild(h("button", { className: "modal-submit", onClick: () => {
      if (!md.text) return;
      data.notes.unshift({ id: uid(), text: md.text, author: md.author, pinned: false, color: md.color, ts: Date.now() });
      saveData(); closeModal();
    }}, "Post Note"));
  }

  overlay.appendChild(sheet);
  return overlay;
}

function makeInput(placeholder, value, onChange, type) {
  const inp = h("input", {
    className: "modal-input", placeholder, type: type || "text",
    onInput: e => onChange(e.target.value)
  });
  inp.value = value;
  return inp;
}

function makeMemberPills(selected, onChange) {
  const wrap = h("div", { className: "modal-pills" });
  FAMILY.forEach(m => {
    const active = selected === m.name;
    wrap.appendChild(h("button", {
      className: "pill" + (active ? " active" : ""),
      style: { borderColor: m.color, color: active ? "#fff" : m.color, background: active ? m.color : "transparent" },
      onClick: () => { onChange(m.name); render(); }
    }, `${m.emoji} ${m.name}`));
  });
  return wrap;
}

function makeOptionPills(options, selected, onChange, color) {
  const wrap = h("div", { className: "modal-pills" });
  options.forEach(opt => {
    const active = selected === opt;
    wrap.appendChild(h("button", {
      className: "pill" + (active ? " active" : ""),
      style: { borderColor: color, color: active ? "#fff" : color, background: active ? color : "transparent" },
      onClick: () => { onChange(opt); render(); }
    }, opt));
  });
  return wrap;
}

// â”€â”€â”€ INIT â”€â”€â”€
loadData();
render();

// Register service worker
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js").catch(() => {});
}
</script>
</body>
</html>
